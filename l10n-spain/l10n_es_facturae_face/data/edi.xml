<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="facturae_backend_type" model="edi.backend.type">
        <field name="name">Spanish Facturae Backend type</field>
        <field name="code">l10n_es_facturae</field>
    </record>
    <record id="facturae_exchange_type" model="edi.exchange.type">
        <field name="name">Spanish Facturae</field>
        <field name="code">l10n_es_facturae</field>
        <field name="backend_type_id" ref="facturae_backend_type" />
        <field name="direction">output</field>
        <field name="exchange_filename_pattern">{record_name}--{dt}</field>
        <field name="exchange_file_ext">xsig</field>
        <field name="exchange_file_auto_generate" eval="True" />
        <field
            name="generate_model_id"
            ref="l10n_es_facturae_face.model_l10n_es_facturae_face_output_handler"
        />
        <field
            name="send_model_id"
            ref="l10n_es_facturae_face.model_l10n_es_facturae_face_output_handler"
        />
        <field
            name="output_validate_model_id"
            ref="l10n_es_facturae_face.model_l10n_es_facturae_face_output_handler"
        />
    </record>
    <record id="facturae_face_exchange_type_rule" model="edi.exchange.type.rule">
        <field name="name">Default</field>
        <field name="type_id" ref="facturae_exchange_type" />
        <field name="model_id" ref="account.model_account_move" />
        <field
            name="enable_domain"
        >[('state', '!=', 'draft'), ('partner_id', '!=', False), ('partner_id.l10n_es_facturae_sending_code', '=', "face"),('move_type', 'in', ['out_invoice', 'out_refund'])]</field>
        <field
            name="enable_snippet"
        >result = not record._has_exchange_record(exchange_type)</field>
    </record>
    <record id="face_backend" model="edi.backend">
        <field name="name">FACe</field>
        <field name="backend_type_id" ref="facturae_backend_type" />
        <field name="output_sent_processed_auto" eval="True" />
    </record>
    <record id="facturae_face_update_exchange_type" model="edi.exchange.type">
        <field name="name">Update Facturae FACe</field>
        <field name="code">l10n_es_facturae_face_update</field>
        <field name="backend_type_id" ref="facturae_backend_type" />
        <field name="backend_id" ref="face_backend" />
        <field name="direction">input</field>
        <field name="exchange_filename_pattern">{record_name}--{dt}</field>
        <field name="exchange_file_ext">json</field>
        <field name="quick_exec" eval="True" />
        <field
            name="receive_model_id"
            ref="l10n_es_facturae_face.model_l10n_es_facturae_face_update_handler"
        />
        <field
            name="process_model_id"
            ref="l10n_es_facturae_face.model_l10n_es_facturae_face_update_handler"
        />
        <field
            name="input_validate_model_id"
            ref="l10n_es_facturae_face.model_l10n_es_facturae_face_update_handler"
        />
    </record>
    <record id="facturae_face_update_exchange_type_rule" model="edi.exchange.type.rule">
        <field name="name">Default</field>
        <field name="type_id" ref="facturae_face_update_exchange_type" />
        <field name="model_id" ref="account.model_account_move" />
        <field
            name="enable_domain"
        >[('state', '!=', 'draft'), ('partner_id.l10n_es_facturae_sending_code', '=', "face")]</field>
        <!-- TODO: Disable when paid -->
        <field
            name="enable_snippet"
        >result = record._has_exchange_record(record.env.ref("l10n_es_facturae_face.facturae_exchange_type"), record.env.ref("l10n_es_facturae_face.face_backend"))</field>
    </record>
    <record id="facturae_face_cancel_exchange_type" model="edi.exchange.type">
        <field name="name">Cancel Facturae FACe</field>
        <field name="code">l10n_es_facturae_face_cancel</field>
        <field name="backend_type_id" ref="facturae_backend_type" />
        <field name="backend_id" ref="face_backend" />
        <field name="direction">output</field>
        <field name="exchange_filename_pattern">{record_name}--{dt}</field>
        <field name="exchange_file_ext">txt</field>
        <field
            name="send_model_id"
            ref="l10n_es_facturae_face.model_l10n_es_facturae_face_cancel_handler"
        />
        <field
            name="output_validate_model_id"
            ref="l10n_es_facturae_face.model_l10n_es_facturae_face_cancel_handler"
        />
    </record>
</odoo>
